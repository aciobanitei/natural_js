/*
 Natural-ARCHITECTURE v0.13.11

 Released under the LGPL v2.1 license
 Date: 2014-09-26T11:11Z

 Copyright 2014 KIM HWANG MAN(bbalganjjm@gmail.com)
*/
(function(r,d){N.version["Natural-ARCHITECTURE"]="0.13.11";d.fn.extend(d.extend(N.prototype,{ajax:function(c){return N.ajax(c)},comm:function(c){return new N.comm(this,c)},request:function(){return this.get(0).request},cont:function(c){return new N.cont(this,c)}}));(function(c){c.ajax=d.ajax;var m,k=c.comm=function(a,b){if(void 0===a)throw c.error("[N.comm]You must input arguments[0]");(c.isPlainObject(a)||c.isString(a))&&void 0===b&&(b=a,a=d());if(c.isPlainObject(a)||c.isArray(a))a=d(a);void 0===
m&&(m=k.initFilterConfig());var f=!1;d(m.beforeInitFilters).each(function(b){if((b=this(a))instanceof Error)return f=!0,!1;void 0!==b&&(a=d(b))});if(f)return a;a.request=new k.request(a,c.isString(b)?{url:b}:b);a.errorHandlers=[];d(d.map(k,function(b,a){if("function"===c.type(k[a])&&"request"!==a)return a})).each(function(b,c){a[c]=function(b){return k[c].call(a,b)}});return a};d.extend(k,{xhr:null,initFilterConfig:function(){var a=[],b=[],f=[],e=[],t=[],l=[],g=c.context.attr("architecture").comm.filters,
h=[],q=c.context.attr("core").spltSepa,n;for(n in g)void 0!==g[n].order&&h.push(g[n].order+q+n);h.sort();for(n in g)void 0===g[n].order&&h.push(n);d(h).each(function(){var c=this.split(q);c=1<c.length?c[1]:c[0];for(var d in g[c])"beforeInit"===d?a.push(g[c][d]):"afterInit"===d?b.push(g[c][d]):"beforeSend"===d?f.push(g[c][d]):"success"===d?e.push(g[c][d]):"error"===d?t.push(g[c][d]):"complete"===d&&l.push(g[c][d])});return{beforeInitFilters:a,afterInitFilters:b,beforeSendFilters:f,successFilters:e,
errorFilters:t,completeFilters:l}},resetFilterConfig:function(){m=k.initFilterConfig();return this},submit:function(a){var b=this;c.isElement(b)&&(d.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var f=!1;d(m.afterInitFilters).each(function(a){if(this(b.request)instanceof Error)return f=!0,!1});if(!f)return d.extend(b.request.options,{beforeSend:function(a,c){var e=!1;d(m.beforeSendFilters).each(function(d,h){if(h.call(b,
b.request,a,c)instanceof Error)return e=!0,!1});if(e)return!1},success:function(e,f,l){var g=!1;d(m.successFilters).each(function(a,c){a=c.call(b,b.request,e,f,l);if(a instanceof Error)return g=!0,!1;void 0!==a&&(e=a)});if(g)return!1;if(c.isElement(b)){if(b.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();b.request.options.append?b.append(e):b.request.options.replace?(b.attr("id",b.attr("id")+"_pending_to_remove"),b.css("display","none"),b.after(e)):b.html(e);
b.is(c.context.attr("architecture").page.context)||c.gc.ds();if(b.request.options.effect)b.hide()[b.request.options.effect[0]](b.request.options.effect[1],b.request.options.effect[2]);if(b.request.options.replace){if(0<b.nextAll(".view_context__:first").length){var h=b.nextAll(".view_context__:first").instance("cont");void 0!==h&&p.trInit.call(this,h,b.request)}b.remove()}else 0<b.children(".view_context__:last").length&&(h=b.children(".view_context__:last").instance("cont"),void 0!==h&&p.trInit.call(this,
h,b.request))}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=r.location.href.replace(/!/g,""))return l.abort(),c.warn("[Communicator.submit.success(urlSync option)]The response was stopped because it was different from the URL at the time of the request and the URL at the time of the response."),!1;if(void 0!==a)try{c.isElement(b)?a.call(b,h):a.call(b,e,b.request),h=void 0}catch(q){throw 0<b.errorHandlers.length&&d(b.errorHandlers).each(function(c,e){e.call(b,q,b.request,
l,f,a)}),c.error("N.comm.submit.success.callback(url:"+b.request.options.url+")",q);}},error:function(a,f,l){var e=!1;d(m.errorFilters).each(function(c,d){if(d.call(b,b.request,a,f,l)instanceof Error)return e=!0,!1});if(!e)throw 0<b.errorHandlers.length&&d(b.errorHandlers).each(function(c,e){e.call(b,l,b.request,a,f)}),c.error("N.comm.submit.error(url:"+b.request.options.url+")",l);},complete:function(a,c){d(m.completeFilters).each(function(e,d){if(d.call(b,b.request,a,c)instanceof Error)return!1})}}),
this.xhr=c.ajax(b.request.options),b},error:function(a){this.errorHandlers.push(a);return this}});k.request=function(a,b){this.options={referrer:r.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,type:"POST",data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,effect:!1,target:null};try{d.extend(this.options,c.context.attr("architecture").comm.request.options)}catch(f){}d.extend(this.options,b);this.attrObj={};this.obj=a;if(null===
this.options.data){if(c.isWrappedSet(a)){if(!c.isElement(a))try{if(this.options.data=this.options.dataIsArray?a.get():a.get(0),this.options.dataIsArray&&"array"===c.type(this.options.data)||"object"===c.type(this.options.data))this.options.data=JSON.stringify(this.options.data)}catch(f){this.options.data=null}}else if(null!=a)try{this.options.data=a,"object"===c.type(this.options.data)&&(this.options.data=JSON.stringify(a))}catch(f){this.options.data=null}null!=this.options.data&&"GET"===this.options.type.toUpperCase()&&
(a=this.options.data.charAt(0),b=this.options.data.charAt(this.options.data.length-1),"{"===a&&"}"===b||"["===a&&"]"===b)&&(this.options.data="q="+encodeURI(this.options.data))}};d.fn.extend(k.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!=this.attrObj[a]&&delete this.attrObj[a];
return this},param:function(a){if(c.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].split("&"),d=0;d<b.length;d++){var e=b[d].split("=");e[0]&&(a[e[0]]=decodeURIComponent(e[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options},reload:function(a){var b=this.options.target.comm(this.options.url);b.request=this;b.submit(a);return this}});var p=c.cont=function(a,b){if(void 0!==a.attr("id")&&
1<c("[id='"+a.attr("id")+"']").length)a=c("#"+a.attr("id")+":not([data-pageid])");else{var d=a.selector;1<a.length&&(a=c(a.selector+":not([data-pageid])"),a.selector=d)}a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|#|\[|\]|'|:|\(|\)|>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};d.extend(p,{trInit:function(a,b){a.request=b;p.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,b)},aop:{pointcuts:{regexp:{fn:function(a,b,c){return(a instanceof
RegExp?a:new RegExp(a)).test(c)}}},wrap:function(a){if(c.context.attr("architecture").cont&&c.context.attr("architecture").cont.advisors&&0<c.context.attr("architecture").cont.advisors.length){var b=c.context.attr("architecture").cont;d(b.advisors).each(function(f,e){c.isPlainObject(e.pointcut)||(e.pointcut={type:"regexp",param:e.pointcut},c.isString(e.pointcut.param)&&(e.pointcut.selector=e.pointcut.selector||e.pointcut.param.substring(0,e.pointcut.param.lastIndexOf(":")),e.pointcut.param=e.pointcut.param.substring(e.pointcut.param.lastIndexOf(":")+
1)));var k=b.pointcuts?b.pointcuts[e.pointcut.type]||p.aop.pointcuts[e.pointcut.type]:p.aop.pointcuts[e.pointcut.type];if(!k)throw c.error("[N.cont.aop.wrap]Unkown pointcut type : "+e.pointcut.type);if(!e.pointcut.selector||a.view.is(e.pointcut.selector)){var l=function(a,b){for(var f in a)a.hasOwnProperty(f)&&(d.isFunction(a[f])?k.fn(e.pointcut.param,a,b+f)&&(a[f]=function(c,d){switch(e.adviceType){case "before":var f=function(){var f=[].slice.call(arguments);e.fn.call(e,a,b+d,f);return c.apply(a,
f)};break;case "after":f=function(){var f=[].slice.call(arguments),g=c.apply(a,f);e.fn.call(e,a,b+d,f,g);return g};break;case "around":f=function(){var f=[].slice.call(arguments);return e.fn.call(e,a,b+d,f,{contFrag:a,args:f,real:c,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":f=function(){var f=[].slice.call(arguments);try{var g=c.apply(a,f)}catch(u){if("error"==e.adviceType)g=e.fn.call(e,a,b+d,f,u);else throw u;}return g}}return f}(a[f],f)):c.isPlainObject(a[f])&&
l.call(this,a[f],b+f+"."))};l.call(this,a,"")}})}}}});c.context={attrObj:{},attr:k.request.prototype.attr}})(N)})(window,jQuery);
